{% extends 'base.html' %}
{% load static widget_tweaks custom_filters %}

{% block title %}Detalle de Orden {{ orden.numero_provisional }}{% endblock %}

{% block extra_head_css %}
    <link rel="stylesheet" href="{% static 'css/orden_detalle.css' %}">
{% endblock %}
S
{% block content %}
<div class="container"> {# Usar container #}
    <div class="page-header">
        <h1>
            <i class="fas fa-file-alt"></i> Detalle de Orden
            <span class="order-number">{{ orden.numero_provisional }}</span> {# Usa clase definida en <style> #}
        </h1>
        <div class="order-status status-{{ orden.estado_general|lower }}"> {# Usa clases definidas en <style> #}
            <i class="fas fa-circle mr-1" style="font-size: 0.6em;"></i> {{ orden.get_estado_general_display }}
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header"><i class="fas fa-info-circle"></i> Información General</div>
        <div class="card-body">
            <div class="info-grid"> {# Usa clase definida en <style> #}
                <div class="info-item"><div class="info-label">Cliente</div><div class="info-value">{{ orden.cliente }}</div></div>
                <div class="info-item"><div class="info-label">Teléfono</div><div class="info-value">{{ orden.telefono|default:"-" }}</div></div>
                <div class="info-item"><div class="info-label">Modelo</div><div class="info-value">{{ orden.modelo_motor|default:"-" }}</div></div>
                <div class="info-item"><div class="info-label">Ruta</div><div class="info-value">{{ orden.ruta|default:"-" }}</div></div>
                <div class="info-item"><div class="info-label">Usuario</div><div class="info-value">{% if orden.chofer %}{{ orden.chofer.username }}{% else %}N/A{% endif %}</div></div>
                <div class="info-item"><div class="info-label">Ingreso</div><div class="info-value">{{ orden.fecha_ingreso|date:"d/m/Y H:i" }}</div></div>
                {% if orden.fecha_programada %}<div class="info-item"><div class="info-label">Programada</div><div class="info-value">{{ orden.fecha_programada|date:"d/m/Y" }}</div></div>{% endif %}
            </div>
            {% if orden.notificacion %}<div class="observaciones mt-3"><div class="info-label">Notificación</div><div class="info-value">{{ orden.notificacion|linebreaksbr }}</div></div>{% endif %}
            {% if orden.observaciones %}<div class="observaciones mt-3"><div class="info-label">Observaciones</div><div class="info-value">{{ orden.observaciones|linebreaksbr }}</div></div>{% endif %}
            {% if orden.imagen %}
            <div class="mt-4">
                <div class="info-label mb-2">Imagen</div>
                <a href="{{ orden.imagen.url }}" target="_blank" title="Ver imagen completa">
                     <img src="{{ orden.imagen.url }}" alt="Imagen de orden" class="order-image"> {# Usa clase definida en <style> #}
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header"><i class="fas fa-boxes"></i> Inventario Recibido</div>
        <div class="card-body">
            {% if inventario_items %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover table-sm"> {# Asume estilos de tabla de components.css #}
                        <thead><tr><th style="width: 50%">Ítem</th><th class="text-center">Cantidad</th><th>Comentario</th></tr></thead>
                        <tbody>
                            {% for item in inventario_items %}<tr><td>{{ item.inventario_item.nombre }}</td><td class="text-center">{{ item.cantidad }}</td><td>{{ item.comentario|default:"-" }}</td></tr>{% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p class="text-muted text-center my-3">No se registraron ítems de inventario.</p>
            {% endif %}
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header"><i class="fas fa-tools"></i> Servicios Solicitados</div>
        <div class="card-body">
            {% if servicios %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover table-sm">
                         <thead><tr><th>Servicio</th><th>Cantidad / Especificación</th></tr></thead>
                        <tbody>
                            {% for serv in servicios %}
                                <tr>
                                    <td>{{ serv.catalogo_servicio.nombre }}</td>
                                    <td>
                                        {% if serv.cantidad and serv.cantidad|stringformat:"s"|trim != "0" and serv.cantidad|stringformat:"s"|trim != "" %}
                                            {{ serv.cantidad }}
                                        {% else %}<span class="text-muted">—</span>{% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                 <p class="text-muted text-center my-3">No se seleccionaron servicios.</p>
            {% endif %}
        </div>
    </div>

    <div class="action-buttons mb-3"> {# Usa clase definida en <style> #}
        <a href="{% url 'lista_ordenes' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Volver a Lista
        </a>
        {% if user.is_superuser %}
            {% if orden.estado_general == 'ESPERA' or orden.estado_general == 'ACEPTADA' or orden.estado_general == 'PROCESO' %}
            <a href="{% url 'editar_orden' orden.id %}" class="btn btn-primary">
                <i class="fas fa-edit"></i> Editar Orden
            </a>
            {% endif %}
        {% endif %}
        <a href="{% url 'tablero_ordenes' %}" class="btn btn-info">
            <i class="fas fa-th-large"></i> Ir al Tablero
        </a>
    </div>
</div>
{% endblock content %}

{% block extra_scripts %}
    {# El script original solo era para el tema, que ya está en base.html #}
{% endblock %}